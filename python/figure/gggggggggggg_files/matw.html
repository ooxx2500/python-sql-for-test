<!DOCTYPE html>
<!-- saved from url=(0039)https://onetag.compass-fit.jp/matw.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>matw</title><script>function setUpCookie() {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.charset = "UTF-8";
      script.async = true;
      script.src = (("https:" == document.location.protocol) ? "https://" : "http://") + document.location.host + "/matw.js";
      var script_0 = document.getElementsByTagName("script")[0];
      script_0.parentNode.insertBefore(script, script_0);
    }

    function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }
    function get3stPartyCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return JSON.parse(c.substring(name.length, c.length));
        }
      }
      return "";
    }
    function createCookie(name, value, days) {
      var expires;
      if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = '; expires=' + date.toGMTString();
      } else {
        expires = '';
      }
      document.cookie = name + '=' +  value  + expires + '; path=/';
    }
    function checkThenUpdateCookie(tagId, adunit) {
      var tagIds = tagId ? tagId.split(',') : [];
      var cookie = get3stPartyCookie('matw_uuid');
      if (cookie) {
        if (cookie && cookie.hasOwnProperty('tags')) {
          tagIds.forEach(function (tagId) {
            cookie['tags'].forEach(function(tag) {
              if (tag.hasOwnProperty('tagId') &&  tag['tagId'] === tagId) {
                found = true;
                if (tag.hasOwnProperty('count') && tag.hasOwnProperty('frequency')) {
                  if (tag['frequency'] === 'DAILY') {
                    tag['count'] = tag['count'] + 1;
                  }
                }
              }
            });
          });

          createCookie('matw_uuid', JSON.stringify(cookie) , 30);
        }
      }
      return JSON.stringify(cookie) ;
    }
    function setCookie(data) {
      window.adunit = data.adunit;
      window.tagId = data.tagId;
      var cookie = null;
      if (window.tagId) {
        checkThenUpdateCookie(window.tagId, window.adunit);
      } else {
        cookie = checkThenCreateCookie(window.adunit);
        if (parent.postMessage) {
          parent.postMessage(cookie, '*');
        } else {
          window.top.postMessage(cookie, '*');
        }
      }

    }
    function uuidv4() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    function removeTag(adunit, cookie) {
      if (cookie['tags']) {
        var tags = adunit && adunit.tags? adunit.tags: [];
        var removingTags = [];
        cookie['tags'].forEach(function(tag) {
          var tagremove = Object.keys(tags).filter(function(key) {
            return key === tag.tagId;
          });
          if (!tagremove || tagremove.length <= 0) {
            removingTags.push(tag.tagId);
          }
        });
        if (removingTags.length > 0) {
          cookie['tags'] = cookie['tags'].filter(function(tag) {
            return  removingTags.indexOf(tag.tagId) === -1
          });
        }
      }
    }
    function checkThenCreateCookie(adunit) {
      var cookie = get3stPartyCookie('matw_uuid');
      if (!cookie) {
        var tags = [];
        if (adunit &&  adunit.tags) {
          Object.keys(adunit.tags).forEach(function (key) {
            var tag = adunit.tags[key];
            var cookieTag = {
              tagId: key,
              count: 0,
              start: new Date(),
              frequency: tag.frequency,
              repeat: tag.repeat,
              version: adunit.version
            };
            tags.push(cookieTag)
          });
        }
        cookie = {
          'matwId': uuidv4(),
          'tags': tags
        };
        createCookie('matw_uuid', JSON.stringify(cookie) , 30);
      } else {
        if (!cookie.hasOwnProperty('tags')) {
          cookie['tags'] = [];
        }
        removeTag(adunit, cookie);
        if (adunit &&  adunit.tags) {
          Object.keys(adunit.tags).forEach(function (key) {
            var realTag = adunit.tags[key];
            var found = false;
            cookie['tags'].forEach(function(tag) {
              if (key === tag.tagId) {
                found = true;
                if (tag.version !== adunit.version) {
                  tag['start'] = new Date();
                  tag['count'] = 0;
                  tag.frequency = realTag.frequency;
                  tag.repeat = realTag.repeat;
                  tag.version = adunit.version;
                }
              }
              if (tag.hasOwnProperty('count') && tag.hasOwnProperty('frequency') && tag.hasOwnProperty('start')) {
                if (tag['frequency'] === 'DAILY' && tag['start']) {
                  var startDate = new Date(tag['start']);
                  var currentDate = new Date();
                  var inDay = startDate.getFullYear() == currentDate.getFullYear()
                    && startDate.getMonth() == currentDate.getMonth()
                    && startDate.getDate() == currentDate.getDate()
                  if (!inDay) {
                    tag['start'] = new Date();
                    tag['count'] = 0;
                  }
                }
              }
            });
            if (!found) {
              var cookieTag = {
                tagId: key,
                count: 0,
                start: new Date(),
                frequency: realTag.frequency,
                repeat: realTag.repeat,
                version: adunit.version
              };
              cookie['tags'].push(cookieTag)
            }

          });
          createCookie('matw_uuid', JSON.stringify(cookie) , 30);
        }
      }
      return JSON.stringify(cookie) ;
    }
    (function() {


      window.addEventListener("message", function(e) {
        setCookie(e.data);
      });
    })();</script></head><body></body></html>